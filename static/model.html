<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Model Checker</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* --- minimal page-local styles --- */
    main { max-width: 1100px; margin: 0 auto; padding: 0 .75rem; }

    .card { background:#fff; border-radius:12px; box-shadow:0 1px 12px rgba(0,0,0,.06);
            padding:1rem; margin:1rem 0; }

    .two { display:grid; gap:1rem; }
    @media (min-width: 960px) { .two { grid-template-columns: 1fr 1fr; } }

    h2 { margin:0 0 .5rem; }
    .muted { color:#6b7280; }

    input[type="text"], textarea {
      width:100%; box-sizing:border-box;
      font-size:1rem; padding:.6rem .75rem;
      border:1px solid #cfcfd4; border-radius:.5rem;
    }
    textarea#sentence { min-height:8rem; font-family:ui-monospace, Menlo, Consolas, monospace; }

    .grid-row { display:grid; gap:.5rem; align-items:center; }
    /* constants: [const] [denotes] [−] */
    .const-row { grid-template-columns: 1fr 1fr 44px; }
    /* symbols: [name] [arity] [extension/value] [−] */
    .sym-row   { grid-template-columns: 1fr 90px 1fr 44px; }
    .sym-row input:nth-child(2){ text-align:center; }

    .label-row { display:grid; gap:.5rem; font-weight:600; margin:.25rem 0; }
    .label-const { grid-template-columns: 1fr 1fr 44px; }
    .label-sym   { grid-template-columns: 1fr 90px 1fr 44px; }

    .row-stack { display:grid; gap:.6rem; }  /* stacks rows vertically */

    .btn { border:none; background:#3949ab; color:#fff; padding:.55rem .9rem;
           border-radius:.6rem; cursor:pointer; }
    .btn:disabled { opacity:.6; cursor:not-allowed; }
    .btn-round { width:40px; height:40px; border-radius:10px; display:grid; place-items:center; font-weight:700; }

    .btn-ghost { background:#eef2ff; color:#1f2a60; }

    .add-wrap { display:flex; justify-content:flex-end; margin-top:.35rem; }

    #out { margin-top:.75rem; font-size:1.05rem; }
    .ok { color:#167d36; font-weight:600; } .bad{ color:#b00020; font-weight:600; }
  </style>
</head>
<body>
  <header><h1>Model Checker</h1></header>

  <nav>
    <a href="/">Home</a>
    <a href="/proof">Proof Checker</a>
    <a href="/model">Model Checker</a>
    <a href="/prop">Truth Tables</a>
    <a href="/instructions">Instructions</a>
  </nav>

  <main>
    <div class="two">
      <!-- Left: domain + constants -->
      <section class="card">
        <h2>Domain</h2>
        <label class="muted">Elements (comma-separated):</label>
        <input id="domain" placeholder="a, b, c" value="a,b" />
        <div class="muted" style="margin-top:.25rem">Example: a , b , c</div>

        <h2 style="margin-top:1rem">Constants</h2>
        <div class="label-row label-const"><div>Constant</div><div>Denotes (domain element)</div><div></div></div>
        <div id="constRows" class="row-stack"></div>
        <div class="add-wrap"><button id="addConst" class="btn btn-round">+</button></div>
        <div class="muted" style="margin-top:.5rem">Format: <code>c</code> denotes element <code>a</code>. Leave empty if none.</div>
      </section>

      <!-- Right: symbols -->
      <section class="card">
        <h2>Symbols</h2>
        <div class="label-row label-sym"><div>Symbol</div><div>Arity</div><div>Extension / Value</div><div></div></div>
        <div id="symRows" class="row-stack"></div>
        <div class="add-wrap"><button id="addSym" class="btn btn-round">+</button></div>

        <p class="muted" style="margin-top:.5rem">
          Arity 0: enter <b>T</b> or <b>F</b> (propositional constant).<br/>
          Arity 1: elements, e.g. <code>a,b</code> (unary predicate).<br/>
          Arity 2–3: tuples, e.g. <code>&lt;a,b&gt;</code>, <code>&lt;b,a&gt;</code> or <code>&lt;a,b,c&gt;</code>, <code>&lt;b,c,a&gt;</code>.
        </p>
      </section>
    </div>

    <!-- Sentence -->
    <section class="card">
      <h2>Sentence</h2>
      <textarea id="sentence" placeholder="∀x (F x → ∃y R x y)"></textarea>
      <div style="display:flex; gap:.75rem; align-items:center; margin-top:.75rem">
        <button id="run" class="btn">Check</button>
        <span id="spinner" class="muted" style="display:none">Checking…</span>
      </div>
      <div id="out"></div>
      <div class="muted" style="margin-top:.5rem">
        ASCII shorthands OK: <code>-></code> (→), <code>~</code> (¬), <code>/\</code> (∧), <code>\/</code> (∨), or “and/or/not”.
      </div>
    </section>
  </main>

  <footer>&copy; 2025 Symbolic Logic Tools</footer>

  <script>
    // ---------- helpers ----------
    const $ = id => document.getElementById(id);
    const mk = (tag, cls) => { const n = document.createElement(tag); if (cls) n.className = cls; return n; };
    const trim = s => (s || '').trim();

    // split on commas but ignore those inside <...>
    function splitCSVRespectAngles(s){
      const out = []; let buf = ''; let depth = 0;
      for (const ch of s){
        if (ch === '<') { depth++; buf += ch; }
        else if (ch === '>') { depth = Math.max(0, depth-1); buf += ch; }
        else if (ch === ',' && depth === 0) { if (buf.trim()) out.push(buf.trim()); buf = ''; }
        else { buf += ch; }
      }
      if (buf.trim()) out.push(buf.trim());
      return out;
    }

    // ---------- rows ----------
    function addConstRow(c = '', v = ''){
      const row = mk('div', 'grid-row const-row');
      const ci = mk('input'); ci.type = 'text'; ci.placeholder = 'c'; ci.value = c;
      const vi = mk('input'); vi.type = 'text'; vi.placeholder = 'a'; vi.value = v;
      const rm = mk('button', 'btn btn-ghost btn-round'); rm.type = 'button'; rm.textContent = '−';
      rm.onclick = () => row.remove();
      row.append(ci, vi, rm);
      $('constRows').append(row);
    }

    function addSymRow(name = '', ar = 1, ext = ''){
      const row = mk('div', 'grid-row sym-row');
      const s  = mk('input'); s.type = 'text'; s.placeholder = 'P / F / R'; s.value = name;
      const a  = mk('input'); a.type = 'text'; a.placeholder = '0..3'; a.value = String(ar);
      const e  = mk('input'); e.type = 'text'; e.placeholder = 'T  |  a,b  |  <a,b>, <b,a>'; e.value = ext;
      const rm = mk('button', 'btn btn-ghost btn-round'); rm.type = 'button'; rm.textContent = '−';
      rm.onclick = () => row.remove();
      row.append(s, a, e, rm);
      $('symRows').append(row);
    }

    // ---------- parse ----------
    function parseDomain(){
      const raw = trim($('domain').value);
      return splitCSVRespectAngles(raw.replace(/\s+/g, '')).filter(Boolean);
    }

    function parseExtension(arity, text){
      const t = trim(text);
      if (arity === 0){
        const up = t.toUpperCase();
        if (up === 'T' || up === 'TRUE')  return { tuples: [[]] };
        if (up === 'F' || up === 'FALSE' || up === '') return { tuples: [] };
        throw new Error('Arity 0 expects T or F.');
      }
      if (arity === 1){
        const elems = splitCSVRespectAngles(t).filter(Boolean);
        return { tuples: elems.map(x => [x]) };
      }
      if (arity === 2 || arity === 3){
        const tuples = [];
        let i = 0;
        while (i < t.length){
          while (i < t.length && /[\s,]/.test(t[i])) i++;
          if (i >= t.length) break;
          if (t[i] !== '<') throw new Error(`Expected "<" starting a ${arity}-tuple.`);
          i++; let depth = 1, buf = '';
          while (i < t.length && depth > 0){
            if (t[i] === '<') { depth++; buf += t[i++]; }
            else if (t[i] === '>') { depth--; if (depth > 0) buf += t[i]; i++; }
            else { buf += t[i++]; }
          }
          const xs = buf.split(',').map(x => x.trim()).filter(Boolean);
          if (xs.length !== arity) throw new Error(`Tuple <${buf}> has arity ${xs.length}, expected ${arity}.`);
          tuples.push(xs);
        }
        return { tuples };
      }
      throw new Error('Arity must be 0,1,2, or 3.');
    }

    function buildModel(){
      const domain = parseDomain();
      if (!domain.length) throw new Error('Domain must not be empty.');

      // constants
      const constInterp = {};
      for (const row of $('constRows').children){
        const c = trim(row.children[0].value);
        const v = trim(row.children[1].value);
        if (c && v) constInterp[c] = v;
        else if (c || v) throw new Error('Each constant row needs both a name and a denotation.');
      }

      // predicates (including 0-ary)
      const predInterp = [];
      for (const row of $('symRows').children){
        const name = trim(row.children[0].value);
        if (!name) continue;
        const ar = parseInt(row.children[1].value || '0', 10);
        if (!(ar >= 0 && ar <= 3)) throw new Error('Arity must be an integer in 0..3.');
        const ext = row.children[2].value;
        const { tuples } = parseExtension(ar, ext);
        predInterp.push({ name, arity: ar, tuples });
      }

      return { domain, constInterp, predInterp };
    }

    // ---------- wire up ----------
    $('addConst').onclick = () => addConstRow();
    $('addSym').onclick   = () => addSymRow();

    // seed a few friendly rows
    addConstRow('c', 'a');
    addSymRow('P', 0, 'T');
    addSymRow('F', 1, 'a');
    addSymRow('R', 2, '<a,b>');

    $('run').onclick = async () => {
      const out = $('out'), spinner = $('spinner');
      out.innerHTML = ''; spinner.style.display = 'inline';
      try {
        const model = buildModel();
        const sentenceText = trim($('sentence').value);
        if (!sentenceText) throw new Error('Please enter a sentence.');
        const res = await fetch('/model/check', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ model, sentenceText })
        });
        const data = await res.json();
        if (data.status === 'ok') {
          out.innerHTML = `Result: ${data.value ? '<span class="ok">TRUE</span>' : '<span class="bad">FALSE</span>'}`;
        } else {
          out.innerHTML = `<span class="bad">${data.status.replaceAll('_',' ')}: ${data.error || 'Unknown error'}</span>`;
        }
      } catch (e) {
        out.innerHTML = `<span class="bad">${e.message || e}</span>`;
      } finally {
        spinner.style.display = 'none';
      }
    };
  </script>
</body>
</html>


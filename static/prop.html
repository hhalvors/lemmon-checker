<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Truth Table Generator</title>
  <link rel="stylesheet" href="style.css" />
  <style>
  table {
    border-collapse: collapse;
    margin-top: 1em;
  }
  th, td {
    padding: 6px 12px;
    border: 1px solid #ccc;
    text-align: center;
  }
  th.formula-col, td.formula-col {
    border-left: 3px solid #000; /* thicker divider before formula column */
    text-align: center;          /* center the truth values */
    font-weight: bold;
  }
</style>
</head>
<body>
  <header>
    <h1>Truth Table Generator</h1>
  </header>

  <nav>
    <a href="/">Home</a>
    <a href="/proof">Proof Checker</a>
    <a href="/model">Model Checker</a>
    <a href="/prop">Truth Tables</a>
    <a href="/instructions">Instructions</a>
  </nav>

  <main>
    <div class="row">
      <div class="card">
        <textarea id="sentence" placeholder="Example: (P → Q) ∨ R   or   (P -> Q) v R"></textarea>

        <div class="controls" style="margin-top:1rem">
          <button id="run" type="button">Build table</button>
          <span id="spinner" class="hint" style="display:none">Working…</span>
          <span class="hint" style="margin-left:.5rem">Tip: Ctrl/⌘ + Enter</span>
        </div>

        <div id="status" class="status" style="margin-top:.5rem"></div>
        <div id="table-wrap" style="margin-top:1rem"></div>
      </div>
    </div>
  </main>

  <footer>
  &copy; 2025 Symbolic Logic Tools |
  <!-- These hrefs are just fallbacks; JS will overwrite them -->
  <a id="bugLink" href="https://github.com/hhalvors/lemmon-checker/issues/new?labels=bug">Report a Bug</a> |
  <a id="feedbackLink" href="https://github.com/hhalvors/lemmon-checker/discussions">Feedback / Questions</a>
</footer>

<script>
  (function () {
    const REPO_OWNER = 'hhalvors';
    const REPO_NAME  = 'lemmon-checker';

    const enc  = encodeURIComponent;
    const page = document.title || 'Unknown page';
    const url  = window.location.href;
    const ua   = navigator.userAgent;

    // --- Prefilled BUG link (Issues) ---
    const bugTitle = `Bug: ${page}`;
    const bugBody =
`**Page:** ${page}
**URL:** ${url}

**Steps to reproduce**
1. …
2. …

**Expected**
…

**Actual**
…

**Console errors** (open DevTools → Console)
\`\`\`
<copy/paste any errors here>
\`\`\`

**Browser/OS:** ${ua}
`;
    const bugUrl = `https://github.com/${REPO_OWNER}/${REPO_NAME}/issues/new` +
                   `?labels=bug&title=${enc(bugTitle)}&body=${enc(bugBody)}`;
    const bugA = document.getElementById('bugLink');
    if (bugA) bugA.href = bugUrl;

    // --- Prefilled FEEDBACK/QUESTION link (Discussions) ---
    const qTitle = `Question/Feedback: ${page}`;
    const qBody =
`**Page:** ${page}
**URL:** ${url}

**Your question/feedback**
- 
`;
    const discussUrl = `https://github.com/${REPO_OWNER}/${REPO_NAME}/discussions/new` +
                       `?category=general&title=${enc(qTitle)}&body=${enc(qBody)}`;
    const qA = document.getElementById('feedbackLink');
    if (qA) qA.href = discussUrl;
  })();
</script>

  <script>
    const byId = id => document.getElementById(id);
    const tf = b => (b ? "T" : "F");
    function clear(node){ while(node.firstChild) node.removeChild(node.firstChild); }

    /** Render the truth table.
     * rows: [{ valuation: {P:Bool,...}, value: Bool }, ...]
     * header: pretty-printed formula string from the server
     */
    function buildTable(rows, header){
  const wrap = byId('table-wrap');
  clear(wrap);
  if(!rows || !rows.length){
    wrap.innerHTML = '<div class="hint">No rows to display.</div>';
    return;
  }

  const first = rows[0];
  const valuation = first.valuation || {};
  const propNames = Object.keys(valuation).sort();
  const formulaKey = Object.keys(first).find(k => k !== "valuation") || "value";

  const table = document.createElement('table');
  const thead = document.createElement('thead');
  const tbody = document.createElement('tbody');

  const trh = document.createElement('tr');
  for (const p of propNames){
    const th = document.createElement('th');
    th.textContent = p;
    trh.appendChild(th);
  }
  const thF = document.createElement('th');
  thF.textContent = header || formulaKey || "Value";
  thF.classList.add("formula-col");  // <--- add class here
  trh.appendChild(thF);
  thead.appendChild(trh);

  for (const row of rows){
    const tr = document.createElement('tr');
    for (const p of propNames){
      const td = document.createElement('td');
      td.textContent = tf(!!row.valuation[p]);
      tr.appendChild(td);
    }
    const tdV = document.createElement('td');
    tdV.textContent = tf(!!row[formulaKey]);
    tdV.classList.add("formula-col"); // <--- add class here
    tr.appendChild(tdV);
    tbody.appendChild(tr);
  }

  table.appendChild(thead);
  table.appendChild(tbody);
  wrap.appendChild(table);
}

    async function run(){
      const btn = byId('run');
      const spinner = byId('spinner');
      const status = byId('status');
      const wrap = byId('table-wrap');

      status.textContent = '';
      status.className = 'status';
      clear(wrap);

      const sTxt = byId('sentence').value.trim();
      if(!sTxt){
        status.textContent = 'Please enter a sentence.';
        status.classList.add('bad');
        return;
      }

      btn.disabled = true; spinner.style.display = 'inline';

      try{
        const res = await fetch('/prop/table', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ sentenceText: sTxt })
        });

        let data;
        try { data = await res.json(); }
        catch { data = { status:'bad_json', error:'Non-JSON response from server.' }; }

        if(data.status === 'ok'){
          buildTable(data.rows, data.header); // use the pretty-printed header from server
          status.textContent = 'Built truth table.';
          status.classList.add('ok');
        }else{
          const msg = data.error || 'Unknown error';
          status.innerHTML = `<span class="bad">${data.status}: ${msg}</span>`;
        }
      }catch(e){
        status.innerHTML = `<span class="bad">${String(e)}</span>`;
      }finally{
        btn.disabled = false; spinner.style.display = 'none';
      }
    }

    // Wire events after DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      const btn = byId('run');
      if(btn){
        btn.addEventListener('click', (e) => { e.preventDefault(); run(); });
      }
      // Ctrl/⌘ + Enter shortcut
      const sentence = byId('sentence');
      sentence.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter'){
          e.preventDefault();
          run();
        }
      });
    });
  </script>
</body>
</html>

